---
title: 长连接和短连接
date: 2020-03-28
tag: 
- 计算机网络
description: 介绍http长连接和短连接，还有其各自特点机器应用场景。
---

### **定义**

　　**在HTTP/1.0中，默认使用的是短连接**。也就是说，浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。如果客户端浏览器访问的某个HTML或其他类型的 Web页中包含有其他的Web资源，如JavaScript文件、图像文件、CSS文件等；当浏览器每遇到这样一个Web资源，就会建立一个HTTP会话。

​		但从 **HTTP/1.1起，默认使用长连接**，用以保持连接特性。使用长连接的HTTP协议，会在响应头有加入这行代码 	$Connection:keep-alive$  。

​		在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的 TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接要客户端和服务端都支持长连接。

​		HTTP协议的长连接和短连接，实质上是TCP协议的长连接和短连接。

### **长连接短连接操作过程**

短连接的操作步骤是：
**建立连接——数据传输——关闭连接...建立连接——数据传输——关闭连接**
长连接的操作步骤是：
**建立连接——数据传输...（保持连接）...数据传输——关闭连接**

### 心跳包

​		心跳包就是在客户端和服务端间定时通知对方自己状态的一个自己定义的命令字，按照一定的时间间隔发送，类似于心跳，所以叫做心跳包。网络中的接收和发送数据都是使用Socket进行实现。但是如果此套接字已经断开（比如一方断网了），那发送数据和接收数据的时候就一定会有问题。可是如何判断这个套接字是否还可以使用呢？这个就需要在系统中创建心跳机制。其实TCP中已经为我们实现了一个叫做心跳的机制。如果你设置了心跳，那TCP就会在一定的时间（比如你设置的是3秒钟）内发送你设置的次数的心跳（比如说2次），并且此信息不会影响你自己定义的协议。也可以自己定义，所谓“心跳”就是定时发送一个自定义的结构体（心跳包或心跳帧），让对方知道自己“在线”,以确保链接的有效性。

### **什么时候用长连接，短连接？** 

 　	**长连接**多用于操作频繁，点对点的通讯，而且连接数不能太多情况。每个TCP连接都需要三步握手，这需要时间，如果每个操作都是先连接再操作的话，那么处理速度会降低很多，所以每个操作完后都不断开，再次处理时直接发送数据包就OK了，不用重新建立TCP连接。例如：数据库的连接用长连接， 如果用短连接频繁的通信会造成socket错误，而且频繁的socket 创建也是对资源的浪费。 

​		**短连接**，比如普通的web网站，只有当浏览器发起请求时才会建立连接，服务器返回相应后，连接立即断开。



### 参考：

1. https://www.cnblogs.com/0201zcr/p/4694945.html
2. https://segmentfault.com/a/1190000014044351#item-5

